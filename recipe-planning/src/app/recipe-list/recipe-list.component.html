<div>
  <h1>Recipe List Component Loaded</h1>
  <p>Current User: {{ currentUser?.username || "No user logged in" }}</p>

  <!-- Post Recipe Button -->
  <div class="post-recipe-button" *ngIf="currentUser">
    <a routerLink="/add-recipe" class="button is-primary">
      <strong>Post a New Recipe</strong>
    </a>
  </div>

  <!-- Shopping List Generation -->
  <div class="shopping-list-controls" *ngIf="currentUser">
    <p class="selection-hint" *ngIf="!showShoppingListButton">
      Select recipes to generate a shopping list
    </p>
    <button 
      *ngIf="showShoppingListButton"
      (click)="generateShoppingList()"
      class="generate-list-button">
      Generate Shopping List ({{ selectedRecipes.size }} recipes)
    </button>
  </div>

  <!-- FILTERS -->
  <div class="filter-group">
    <h4>Type:</h4>
    <button (click)="selectFilter('type', '')">All</button>
    <button (click)="selectFilter('type', 'breakfast')">Breakfast</button>
    <button (click)="selectFilter('type', 'lunch')">Lunch</button>
    <button (click)="selectFilter('type', 'dinner')">Dinner</button>
    <button (click)="selectFilter('type', 'snack')">Snack</button>
  </div>

  <div class="filter-group">
    <h4>Cuisine:</h4>
    <button (click)="selectFilter('cuisine', '')">All</button>
    <button (click)="selectFilter('cuisine', 'italian')">Italian</button>
    <button (click)="selectFilter('cuisine', 'mexican')">Mexican</button>
    <button (click)="selectFilter('cuisine', 'indian')">Indian</button>
  </div>

  <div class="filter-group">
    <h4>Max Cooking Time:</h4>
    <button (click)="selectFilter('cookingTime', 0)">Any</button>
    <button (click)="selectFilter('cookingTime', 30)">≤ 30 min</button>
    <button (click)="selectFilter('cookingTime', 60)">≤ 60 min</button>
  </div>

  <div class="filter-group">
    <h4>Ingredient:</h4>
    <button (click)="selectFilter('ingredient', '')">Any</button>
    <button (click)="selectFilter('ingredient', 'egg')">Egg</button>
    <button (click)="selectFilter('ingredient', 'chicken')">Chicken</button>
    <button (click)="selectFilter('ingredient', 'rice')">Rice</button>
  </div>

  <div>
    <button (click)="clearFilters()">Clear All Filters</button>
  </div>

  <!-- SEARCH BAR -->
  <input
    type="text"
    placeholder="Search recipes..."
    [(ngModel)]="searchTerm"
    (input)="onSearch(searchTerm)"
    (focus)="isFocused = true"
    (blur)="onBlur()"
    class="search-box"
  />

  <!-- Search Results -->
  <div *ngIf="(isFocused || searchTerm) && filteredRecipes.length > 0">
    <div *ngFor="let recipe of filteredRecipes" class="search-result">
      <a
        [routerLink]="['/recipe', recipe.id]"
        (click)="clearSearch()"
        class="search-link"
      >
        <h3>{{ recipe.recipe_name }}</h3>
        <p>By {{ recipe.author }}</p>
      </a>
    </div>
  </div>

  <div *ngIf="(isFocused || searchTerm) && filteredRecipes.length === 0" class="no-results">
    <p>No recipes found matching "{{ searchTerm }}"</p>
  </div>

  <!-- RECIPES LIST -->
  <div class="recipe-list-container">
    <div class="recipe-grid">
      <mat-card *ngFor="let recipe of recipes" class="recipe-card">
        <mat-card-header>
          <mat-card-title>{{recipe.recipe_name}}</mat-card-title>
          <mat-card-subtitle>By {{recipe.author}}</mat-card-subtitle>
        </mat-card-header>
        <img mat-card-image [src]="recipe.image_url" alt="{{recipe.recipe_name}}" (error)="handleImageError($event)">
        <mat-card-content>
          <p>{{recipe.description}}</p>
          <p>Cooking Time: {{recipe.cooking_time}} minutes</p>
          <p>Difficulty: {{recipe.difficulty}}</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button (click)="navigateToRecipe(recipe.id)">
            <mat-icon>visibility</mat-icon>
            View Recipe
          </button>
          <button mat-button (click)="toggleRecipeSelection(recipe)">
            <mat-icon>{{isRecipeSelected(recipe) ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
            {{isRecipeSelected(recipe) ? 'Selected' : 'Select'}}
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
